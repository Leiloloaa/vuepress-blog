---
title: React Hooks
date: 2021-07-13 11:39:29
permalink: /pages/026608/
categories:
  - ã€ŠReactã€‹ç¬”è®°
tags:
  - 
---

# React Hooks

React 16 ç‰ˆæœ¬å¢åŠ äº† hooksï¼Œç¬”è€…è®¤ä¸ºè¿™æå¤§çš„æ”¹å˜äº† React çš„å¼€å‘æ¨¡å¼ï¼Œå¹¶ä¸”è¿™æ˜¯æœ‰åˆ©çš„ã€‚æœ¬æ–‡ä¸»è¦è®°å½•`useState`ã€`useEffect`ã€`useReducer`ã€`useContext`ç­‰å¸¸ç”¨çš„é’©å­å‡½æ•°ã€‚
<!-- more -->

**æ¯”è¾ƒä»£ç **

- ä¸ä½¿ç”¨ Hooks
```jsx
// setStateÂ åªåœ¨åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°ä¸­æ˜¯â€œå¼‚æ­¥â€çš„ï¼Œåœ¨åŸç”Ÿäº‹ä»¶å’ŒÂ setTimeoutÂ ä¸­éƒ½æ˜¯åŒæ­¥çš„ã€‚
// setStateçš„â€œå¼‚æ­¥â€å¹¶ä¸æ˜¯è¯´å†…éƒ¨ç”±å¼‚æ­¥ä»£ç å®ç°ï¼Œå…¶å®æœ¬èº«æ‰§è¡Œçš„è¿‡ç¨‹å’Œä»£ç éƒ½æ˜¯åŒæ­¥çš„ï¼Œåªæ˜¯åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°çš„è°ƒç”¨é¡ºåºåœ¨æ›´æ–°ä¹‹å‰ï¼Œå¯¼è‡´åœ¨åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°ä¸­æ²¡æ³•ç«‹é©¬æ‹¿åˆ°æ›´æ–°åçš„å€¼ï¼Œå½¢å¼äº†æ‰€è°“çš„â€œå¼‚æ­¥â€ï¼Œå½“ç„¶å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•° setState(partialState, callback) ä¸­çš„callbackæ‹¿åˆ°æ›´æ–°åçš„ç»“æœã€‚
// setStateÂ çš„æ‰¹é‡æ›´æ–°ä¼˜åŒ–ä¹Ÿæ˜¯å»ºç«‹åœ¨â€œå¼‚æ­¥â€ï¼ˆåˆæˆäº‹ä»¶ã€é’©å­å‡½æ•°ï¼‰ä¹‹ä¸Šçš„ï¼Œåœ¨åŸç”Ÿäº‹ä»¶å’ŒsetTimeout ä¸­ä¸ä¼šæ‰¹é‡æ›´æ–°ï¼Œåœ¨â€œå¼‚æ­¥â€ä¸­å¦‚æœå¯¹åŒä¸€ä¸ªå€¼è¿›è¡Œå¤šæ¬¡Â setStateÂ ï¼ŒÂ setStateÂ çš„æ‰¹é‡æ›´æ–°ç­–ç•¥ä¼šå¯¹å…¶è¿›è¡Œè¦†ç›–ï¼Œå–æœ€åä¸€æ¬¡çš„æ‰§è¡Œï¼Œå¦‚æœæ˜¯åŒæ—¶Â setStateÂ å¤šä¸ªä¸åŒçš„å€¼ï¼Œåœ¨æ›´æ–°æ—¶ä¼šå¯¹å…¶è¿›è¡Œåˆå¹¶æ‰¹é‡æ›´æ–°ã€‚
class HookTest extends Component {
  constructor(props) {
    super(props);
    this.state = { count:0 }
    this.addCount = this.addCount.bind(this)
  }
  render() {
    return ( <div>{this.state.count}<button onClick={this.addCount}>ç‚¹æˆ‘åŠ 1</button></div> );
  }
  addCount(){
    this.setState({ count: ++this.state.count });
  }
}
```
- ä½¿ç”¨ Hooks
```jsx
function HookTest() {
  const [count, setCount] = useState(0);
  render() {
        return ( 
        <div>
            {count}<button onClick={()=>{setCount(count+1)}}>ç‚¹æˆ‘åŠ 1</button>
        </div>    
        );
  }
}
```

ä»£ç ç®€æ´ç¨‹åº¦ä¸è¨€è€Œå–»ï¼Œä½œä¸ºä¸€ä¸ªåˆå­¦è€…ï¼Œå¼€å§‹å°±å­¦åˆ°ç²¾ç®€çš„å†™æ³•ï¼Œè¿˜æ˜¯å¾ˆä¸é”™çš„ï¼

## React ç»„ä»¶åŒ–

**ä¸€åˆ‡çš†ä¸ºç»„ä»¶ã€ä¸‡ç‰©éƒ½æ˜¯å‡½æ•°**

- åŠŸèƒ½ï¼ˆæ— çŠ¶æ€ï¼‰ç»„ä»¶
    - Function Component åŠŸèƒ½ç»„ä»¶ä¹Ÿå«åšæ— çŠ¶æ€ç»„ä»¶ï¼Œä¸€èˆ¬åªè´Ÿè´£æ¸²æŸ“
    ```
    function Hello (){
         return(
            <div>
                <h1>Function Component</h1>
            </div>
        )
    }
    ```
- æ¸²æŸ“ç»„ä»¶
    - Presentational Component å’ŒåŠŸèƒ½ï¼ˆæ— çŠ¶æ€ï¼‰ç»„ä»¶ç±»ä¼¼ å…¨å‡­ å‚æ•° props 
    ```
    const hello =(props)=>{
        return(
            <div>
                <h1>Presentational Component</h1>
            </div>
        )
    }
    ```
- ç±»ï¼ˆæœ‰çŠ¶æ€ï¼‰ç»„ä»¶
    - Class Component ç±»ç»„ä»¶å°±æ˜¯çŠ¶æ€ç»„ä»¶ï¼Œä¸€èˆ¬æœ‰äº¤äº’é€»è¾‘ä¹Ÿä¸šåŠ¡é€»è¾‘
    ```
    class Hello extend Component{
         ...(ä¸šåŠ¡é€»è¾‘)
         return(
            <div>
                <h1>Class Component</h1>
            </div>
        )
    }
    ```

å†™ç»„ä»¶çš„æ—¶å€™ï¼Œåº”è¯¥è€ƒè™‘æ˜¯å¦å¯ä»¥ä½œä¸ºæ— çŠ¶æ€ç»„ä»¶ã€æ˜¯å¦åˆ†ç¦»UIç»„ä»¶ç­‰ã€‚è¿™æ ·æœ‰åˆ©äºåæœŸä»£ç çš„ç»´æŠ¤ã€‚

> Hook å‡½æ•°å¿…é¡»ä»¥ "use" å‘½åå¼€å¤´ï¼Œå› ä¸ºè¿™æ ·æ‰æ–¹ä¾¿ eslint åšæ£€æŸ¥ï¼Œé˜²æ­¢ç”¨ condition åˆ¤æ–­åŒ…è£¹ useHook è¯­å¥ã€‚

## useState

ğŸ‚ğŸº å¯ä»¥ä¸ç”¨ this

**ä½¿ç”¨**

```jsx
import { useState } from 'react';

fucntion HookTest(){
    const [count, setCount] = useState(0);
    // ä¸Šé¢æ˜¯ ES6 è§£æ„èµ‹å€¼ å®šä¹‰å˜é‡åçš„åŒæ—¶ è®¾ç½®ä¿®æ”¹æ–¹æ³• å¹¶åˆå§‹åŒ–
    // ç­‰åŒäº 
    // let _useState = useState(0);
    // let count = _useState[0];
    // let setCount = _useState[1];
    // ä¸Šé¢çš„æ„æ€ï¼š`useState`è¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°æ˜¯çŠ¶æ€çš„åˆå§‹å€¼(Initial state)ï¼Œ
    // å®ƒè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„çš„ç¬¬0ä½æ˜¯å½“å‰çš„çŠ¶æ€å€¼ï¼Œç¬¬1ä½æ˜¯å¯ä»¥æ”¹å˜çŠ¶æ€å€¼çš„æ–¹æ³•å‡½æ•°ã€‚ 
    // æ‰€ä»¥ä¸Šé¢çš„ä»£ç çš„æ„æ€å°±æ˜¯å£°æ˜äº†ä¸€ä¸ªçŠ¶æ€å˜é‡ä¸ºcountï¼Œå¹¶æŠŠå®ƒçš„åˆå§‹å€¼è®¾ä¸º0ï¼Œ
    // åŒæ—¶æä¾›äº†ä¸€ä¸ªå¯ä»¥æ”¹å˜`count`çš„çŠ¶æ€å€¼çš„æ–¹æ³•å‡½æ•°ã€‚
    
    // åœ¨ jsx ä¸­ä½¿ç”¨
    return <h1>{count}<button onClick={()=>setCount(count +1)}></button></h1>
}
```

**é‡ç‚¹çŸ¥è¯†**

- `useState`çš„åˆå§‹å€¼ï¼Œåªåœ¨ç¬¬ä¸€æ¬¡æœ‰æ•ˆ
    - useSateåªåˆå§‹åŒ–ä¸€æ¬¡çš„åŸå› å¤§æ¦‚æ˜¯ï¼Œåœ¨ç¬¬äºŒæ¬¡updateReducerçš„æ—¶å€™ï¼Œè°ƒç”¨updateWorkInProgressHookè·å–çš„pendingä»¥åŠbaseQueueä¸ºnullï¼Œå¯¼è‡´æ‹¿çš„è¿˜æ˜¯ä¹‹å‰hookä¸Šçš„memoizedState
- ä¸å¯ä»¥åœ¨ if ä¸­å£°æ˜ 
    - React Hooks å¹¶ä¸æ˜¯é€šè¿‡ Proxy æˆ–è€… getters å®ç°çš„ï¼Œè€Œæ˜¯é€šè¿‡æ•°ç»„å®ç°çš„ï¼Œæ¯æ¬¡ `useState` éƒ½ä¼šæ”¹å˜ä¸‹æ ‡ï¼Œå¦‚æœ `useState`è¢«åŒ…è£¹åœ¨ condition ä¸­ï¼Œé‚£æ¯æ¬¡æ‰§è¡Œçš„ä¸‹æ ‡å°±å¯èƒ½å¯¹ä¸ä¸Šï¼Œå¯¼è‡´ `useState` å¯¼å‡ºçš„ `setter` æ›´æ–°é”™æ•°æ®ã€‚


## useEffect

ğŸ‚ğŸº åœ¨å‡½æ•°ç»„ä»¶é‡Œé¢ä½¿ç”¨ class ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œå¹¶ä¸”è¿˜æ˜¯ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„é›†åˆï¼

**class ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ**

```
// æŒ‚è½½é˜¶æ®µï¼ˆå¸¸ç”¨åˆ°çš„é’©å­å‡½æ•°ï¼‰
componentWillmount()
render()
componentDidMount()

//æ›´æ–°é˜¶æ®µ
componentWillReceiveProps()
shouldComponentUpdate()
componentWillUpdate ()
render()
componentDidUpdate()

// å¸è½½é˜¶æ®µ
componentWillUnmount()
```

**ä½¿ç”¨ useEffect æ›¿ä»£**

```jsx
// React é¦–æ¬¡æ¸²æŸ“å’Œä¹‹åçš„æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè°ƒç”¨ä¸€é useEffect å‡½æ•°ï¼Œ
// è€Œä¹‹å‰æˆ‘ä»¬è¦ç”¨ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°
// åˆ†åˆ«è¡¨ç¤ºé¦–æ¬¡æ¸²æŸ“( componentDidMount )å’Œæ›´æ–°å¯¼è‡´çš„é‡æ–°æ¸²æŸ“( componentDidUpdate )ã€‚
// useEffect ä¸­å®šä¹‰çš„å‡½æ•°çš„æ‰§è¡Œä¸ä¼šé˜»ç¢æµè§ˆå™¨æ›´æ–°è§†å›¾ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›å‡½æ•°æ—¶å¼‚æ­¥æ‰§è¡Œçš„ï¼Œè€Œ 
// componentDidMountå’Œ componentDidUpdate ä¸­çš„ä»£ç éƒ½æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚

useEffect(() => {
    console.log(123);
});

```

**çŸ¥è¯†ç‚¹**

- å¯ä»¥å†™å¤šä¸ª`useEffect`
- ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª`[]`ï¼Œæ•°ç»„ä¸­å¯ä»¥å†™å…¥å¾ˆå¤šçŠ¶æ€å¯¹åº”çš„å˜é‡ï¼Œæ„æ€æ˜¯å½“çŠ¶æ€å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬æ‰è¿›è¡Œè§£ç»‘ã€‚ä½†æ˜¯å½“ä¼ ç©ºæ•°ç»„`[]`æ—¶ï¼Œå°±æ˜¯å½“ç»„ä»¶å°†è¢«é”€æ¯æ—¶æ‰è¿›è¡Œè§£ç»‘ï¼Œè¿™ä¹Ÿå°±å®ç°äº† componentWillUnmount çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°
   - å¦‚æœæˆ‘ä»¬æƒ³æ¯æ¬¡ count å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬éƒ½è¿›è¡Œè§£ç»‘ï¼Œåªéœ€è¦åœ¨ç¬¬äºŒä¸ªå‚æ•°çš„æ•°ç»„é‡ŒåŠ å…¥ count å˜é‡å°±å¯ä»¥äº†ã€‚
   ```js
  useEffect(() => {
    console.log('++++');
  }, [count]);
   ```
- åœ¨`useEffect`çš„`return`é‡Œé¢å¯ä»¥åšå–æ¶ˆè®¢é˜…çš„äº‹
   - componentWillUnmount ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆç»„ä»¶å°†è¦è¢«å¸è½½æ—¶æ‰§è¡Œï¼‰ã€‚æ¯”å¦‚æˆ‘ä»¬çš„å®šæ—¶å™¨è¦æ¸…ç©ºï¼Œé¿å…å‘ç”Ÿå†…å­˜æ³„æ¼ï¼›æ¯”å¦‚ç™»å½•çŠ¶æ€è¦å–æ¶ˆæ‰ï¼Œé¿å…ä¸‹æ¬¡è¿›å…¥ä¿¡æ¯å‡ºé”™ã€‚componentWillUnmount -è§£ç»‘å‰¯ä½œç”¨
   ```js 
   useEffect(() => { 
       const subscription = è®¢é˜…äº‹ä»¶ï¼
       return () => { è§£ç»‘äº‹ä»¶ï¼ } }
   ,[])
   ```
 
 ## useReducer
 
 ğŸ‚ğŸº å®ƒå¯ä»¥å¢å¼ºæˆ‘ä»¬çš„`Reducer`ï¼Œå®ç°ç±»ä¼¼Reduxçš„åŠŸèƒ½ã€‚
 äº†è§£æ›´å¤š Redux çš„çŸ¥è¯†å¯ä»¥ç§»æ­¥ [ä½ æƒ³çŸ¥é“çš„Reduxå’ŒReact-Routeréƒ½åœ¨è¿™é‡Œ](https://juejin.cn/post/6984228391159332901)
  
 **ä½¿ç”¨**
 
 ```jsx
import React, { useReducer } from 'react';

function ReducerDemo(){
    const [ count , dispatch ] =useReducer((state,action)=>{
        switch(action){
            case 'add':
                return state+1
            case 'sub':
                return state-1
            default:
                return state
        }
    },0)
    return (
       <div>
           <h1>{count}</h1>
           <button onClick={()=>dispatch('add')}>Increment</button>
           <button onClick={()=>dispatch('sub')}>Decrement</button>
       </div>
    )

}

export default ReducerDemo
```

## useContext

 ğŸ‚ğŸº useContext è·¨è¶Šç»„ä»¶å±‚çº§ç›´æ¥ä¼ é€’å˜é‡ï¼Œå®ç°å…±äº«ã€‚
 
éœ€è¦æ³¨æ„çš„æ˜¯ useContext å’Œ redux çš„ä½œç”¨æ˜¯ä¸åŒçš„ï¼Œä¸€ä¸ªè§£å†³çš„æ˜¯ç»„ä»¶ä¹‹é—´å€¼ä¼ é€’çš„é—®é¢˜ï¼Œä¸€ä¸ªæ˜¯åº”ç”¨ä¸­ç»Ÿä¸€ç®¡ç†çŠ¶æ€çš„é—®é¢˜ï¼Œä½†é€šè¿‡å’Œ useReducer çš„é…åˆä½¿ç”¨ï¼Œå¯ä»¥å®ç°ç±»ä¼¼ Redux çš„ä½œç”¨ã€‚

```jsx
import React, {
  useState,
  useEffect,
  createContext,
  useContext,
  useReducer
} from 'react';

// 1ã€åˆ›å»ºä¸€ä¸ª createContext
const CountContext = createContext();

function Counter() {
  const count = useContext(CountContext); //ä¸€å¥è¯å°±å¯ä»¥å¾—åˆ°count
  return <h2>{count}</h2>;
}

function HookTest() {
  const [count, dispatch] = useReducer((state, action) => {
    switch (action) {
      case 'add':
        return state + 1;
      case 'sub':
        return state - 1;
      default:
        return state;
    }
  }, 0);

  return (
    <div>
      {/* 2ã€ åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡å˜é‡ */}
      <CountContext.Provider value={count}>
        <Counter />
      </CountContext.Provider>
      {/* {count} */}
      <button
        onClick={() => {
          dispatch('add');
        }}
      >
        åŠ 1
      </button>{' '}
      <button
        onClick={() => {
          dispatch('sub');
        }}
      >
        å‡1
      </button>
    </div>
  );
}

export default HookTest;
```

ä½¿ç”¨`useContext`å’Œ`useReducer`æ˜¯å¯ä»¥å®ç°ç±»ä¼¼`Redux`çš„æ•ˆæœ

**ä½¿ç”¨æ­¥éª¤**

- åˆ›å»ºä¸€ä¸ª createContextï¼›const CountContext = createContext();
- åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡å˜é‡
    ```
     <CountContext.Provider value={count}>
        <Counter />
     </CountContext.Provider>
    ```
- åœ¨å­ç»„ä»¶ä¸­é€šè¿‡ useContextè·å¾—
    ```
    function Counter() {
        const count = useContext(CountContext); //ä¸€å¥è¯å°±å¯ä»¥å¾—åˆ°count
        return <h2>{count}</h2>;
    }
    ```
